/*
 *  Copyright 2017 Regents of the University of California.
 *
 *  Licensed under the Educational Community License, Version 2.0 (the "license");
 *  you may not use this file except in compliance with the License. You may
 *  obtain a copy of the license at
 *
 *  https://opensource.org/licenses/ECL-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 */
package org.opentestsystem.ap.ims.model;

import java.util.List;

import com.fasterxml.jackson.annotation.JsonCreator;
import com.fasterxml.jackson.annotation.JsonProperty;
import lombok.Data;
import lombok.EqualsAndHashCode;
import org.opentestsystem.saaif.item.ItemRelease;

import static org.opentestsystem.ap.ims.model.ItemConstants.ItemLanguage.LANG_ENU;
import static org.opentestsystem.ap.ims.model.ItemConstants.ItemType.TYPE_WER;
import static org.opentestsystem.ap.ims.model.ItemMapper.findEnglishContent;
import static org.opentestsystem.ap.ims.model.ItemMapper.findExemplarResponses;
import static org.opentestsystem.ap.ims.model.ItemMapper.mapToSaaifExemplarResponses;
import static org.opentestsystem.ap.ims.model.ItemMapper.newSaaifAssessmentItem;
import static org.opentestsystem.ap.ims.model.ItemMapper.newSaaifContent;
import static org.opentestsystem.ap.ims.model.ItemMapper.newSaaifItem;
import static org.opentestsystem.ap.ims.model.ItemMapper.newSaaifItemAttributeList;

@Data
@EqualsAndHashCode(callSuper = true)
public class WerItem extends Item {

    public static String PAGE_LAYOUT = "21";

    public static String RESPONSE_TYPE = "HTMLEditor";

    private String prompt;

    private List<String> exemplarResponses;

    @JsonCreator
    public WerItem(@JsonProperty("id") String id) {
        super(id);
    }


    // ------------------------------------------------------------------------

    @Override
    public ItemRelease toSaaif() {
        final ItemRelease.Item.Attriblist attributeList = newSaaifItemAttributeList(getId(),
            getType(), PAGE_LAYOUT, RESPONSE_TYPE);

        final ItemRelease.Item.Content content = newSaaifContent(LANG_ENU);

        final ItemRelease.Item item = newSaaifItem(getId(), getType());
        item.setAttriblist(attributeList);
        item.getContent().add(content);

        return newSaaifAssessmentItem(item);
    }

    @Override
    public ItemRelease toSaaif(ItemRelease saaifItemRelease) {
        final ItemRelease.Item saaifItem = saaifItemRelease.getItem();

        final ItemRelease.Item.Content englishContent = findEnglishContent(saaifItem);

        englishContent.setStem(getPrompt());

        mapToSaaifExemplarResponses(getExemplarResponses(), englishContent);

        return saaifItemRelease;
    }

    @Override
    public void fromSaaif(ItemRelease saaifItemRelease) {
        final ItemRelease.Item saaifItem = saaifItemRelease.getItem();

        final ItemRelease.Item.Content englishContent = findEnglishContent(saaifItem);

        setPrompt(englishContent.getStem());
        setExemplarResponses(findExemplarResponses(englishContent));
    }

    // ------------------------------------------------------------------------

    @Override
    public String getType() {
        return TYPE_WER;
    }

    // ------------------------------------------------------------------------

    public static final class WerItemBuilder {

        private String id;

        private String beingCreatedBy;

        private String beingEditedBy;

        private String prompt;

        private List<String> exemplarResponses;

        private WerItemBuilder(final String id) {
            this.id = id;
        }

        public static WerItemBuilder aWerItem(final String id) {
            return new WerItemBuilder(id);
        }

        public WerItemBuilder beingCreatedBy(String beingCreatedBy) {
            this.beingCreatedBy = beingCreatedBy;
            return this;
        }

        public WerItemBuilder beingEditedBy(String beingEditedBy) {
            this.beingEditedBy = beingEditedBy;
            return this;
        }

        public WerItemBuilder prompt(String prompt) {
            this.prompt = prompt;
            return this;
        }

        public WerItemBuilder exemplarResponses(List<String> exemplarResponses) {
            this.exemplarResponses = exemplarResponses;
            return this;
        }

        public WerItem build() {
            WerItem werItem = new WerItem(id);
            werItem.setBeingCreatedBy(beingCreatedBy);
            werItem.setBeingEditedBy(beingEditedBy);
            werItem.setPrompt(prompt);
            werItem.setExemplarResponses(exemplarResponses);
            return werItem;
        }
    }



}
