/*
 *  Copyright 2017 Regents of the University of California.
 *
 *  Licensed under the Educational Community License, Version 2.0 (the "license");
 *  you may not use this file except in compliance with the License. You may
 *  obtain a copy of the license at
 *
 *  https://opensource.org/licenses/ECL-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 */
package org.opentestsystem.saaif.item;

import static org.opentestsystem.saaif.item.ItemConstants.ItemFormat.FORMAT_SHORT_ANSWER;
import static org.opentestsystem.saaif.item.ItemConstants.ItemLanguage.LANG_EN;
import static org.opentestsystem.saaif.item.ItemConstants.ItemPageLayout.PAGE_LAYOUT_SHORT_ANSWER;
import static org.opentestsystem.saaif.item.ItemConstants.ItemResponseType.RESPONSE_TYPE_HTML_EDITOR;
import static org.opentestsystem.saaif.item.ItemConstants.ItemVersion.ITEM_RELEASE_VERSION;
import static org.opentestsystem.saaif.item.ItemConstants.ItemVersion.ITEM_VERSION;

public class SaaifEntityFactory {

    private static final ObjectFactory FACTORY = new ObjectFactory();

    public ItemRelease newItemRelease(String itemId, String itemFormat) {
        final ItemRelease itemRelease = FACTORY.createItemrelease();
        itemRelease.setVersion(ITEM_RELEASE_VERSION);
        itemRelease.setItem(newItem(itemId, itemFormat));
        return itemRelease;
    }

    public ItemRelease.Item newItem(String itemId, String itemFormat) {
        final ItemRelease.Item item;
        switch (itemFormat) {
            case FORMAT_SHORT_ANSWER:
                item = newShortAnswerItem(itemId);
                break;
            default:
                item = null;
                break;
        }
        return item;
    }

    public ItemRelease.Item newShortAnswerItem(String itemId) {
        final ItemRelease.Item.Attriblist attributeList = newItemAttributeList(FORMAT_SHORT_ANSWER, PAGE_LAYOUT_SHORT_ANSWER,

            RESPONSE_TYPE_HTML_EDITOR);

        final ItemRelease.Item item = FACTORY.createItemreleaseItem();
        item.setId(itemId);
        item.setFormat(FORMAT_SHORT_ANSWER);
        item.setVersion(ITEM_VERSION);
        item.setAttriblist(attributeList);
        item.getContent().add(newContent(LANG_EN));

        return item;
    }

    public ItemRelease.Item.Content newContent(String lang) {
        ItemRelease.Item.Content content = FACTORY.createItemreleaseItemContent();
        content.setVersion(ITEM_RELEASE_VERSION);
        content.setLanguage(LANG_EN);
        content.setStem("<p style=\"\">Now, you will start investigating <span id=\"item_2061_TAG_1\" " +
            "class=\"its-tag\" data-tag=\"word\" data-tag-boundary=\"start\" data-word-index=\"1\"></span>ways<span " +
            "class=\"its-tag\" data-tag-ref=\"item_2061_TAG_1\" data-tag-boundary=\"end\"></span> to <span " +
            "id=\"item_2061_TAG_2\" class=\"its-tag\" data-tag=\"word\" data-tag-boundary=\"start\" " +
            "data-word-index=\"2\"></span>save<span class=\"its-tag\" data-tag-ref=\"item_2061_TAG_2\" " +
            "data-tag-boundary=\"end\"></span> water. Taking <span id=\"item_2061_TAG_3\" class=\"its-tag\" " +
            "data-tag=\"word\" data-tag-boundary=\"start\" data-word-index=\"3\"></span>shorter<span " +
            "class=\"its-tag\" data-tag-ref=\"item_2061_TAG_3\" data-tag-boundary=\"end\"></span> <span " +
            "id=\"item_2061_TAG_4\" class=\"its-tag\" data-tag=\"word\" data-tag-boundary=\"start\" " +
            "data-word-index=\"4\"></span>showers<span class=\"its-tag\" data-tag-ref=\"item_2061_TAG_4\" " +
            "data-tag-boundary=\"end\"></span> is one <span id=\"item_2061_TAG_5\" class=\"its-tag\" " +
            "data-tag=\"word\" data-tag-boundary=\"start\" data-word-index=\"5\"></span>way<span class=\"its-tag\" " +
            "data-tag-ref=\"item_2061_TAG_5\" data-tag-boundary=\"end\"></span> to <span id=\"item_2061_TAG_6\" " +
            "class=\"its-tag\" data-tag=\"word\" data-tag-boundary=\"start\" data-word-index=\"2\"></span>save<span " +
            "class=\"its-tag\" data-tag-ref=\"item_2061_TAG_6\" data-tag-boundary=\"end\"></span> water.</p><p " +
            "style=\"font-weight:normal; \">&#xA0;</p><p style=\"font-weight:normal; \">What is the range for the " +
            "amount of water, in gallons, that <span id=\"item_2061_TAG_7\" class=\"its-tag\" data-tag=\"word\" " +
            "data-tag-boundary=\"start\" data-word-index=\"6\"></span>is saved<span class=\"its-tag\" " +
            "data-tag-ref=\"item_2061_TAG_7\" data-tag-boundary=\"end\"></span> if a <span id=\"item_2061_TAG_8\" " +
            "class=\"its-tag\" data-tag=\"word\" data-tag-boundary=\"start\" data-word-index=\"4\"></span>shower<span" +
            " class=\"its-tag\" data-tag-ref=\"item_2061_TAG_8\" data-tag-boundary=\"end\"></span> <span " +
            "id=\"item_2061_TAG_9\" class=\"its-tag\" data-tag=\"word\" data-tag-boundary=\"start\" " +
            "data-word-index=\"7\"></span>lasts<span class=\"its-tag\" data-tag-ref=\"item_2061_TAG_9\" " +
            "data-tag-boundary=\"end\"></span> for 5 minutes <span id=\"item_2061_TAG_10\" class=\"its-tag\" " +
            "data-tag=\"word\" data-tag-boundary=\"start\" data-word-index=\"8\"></span>instead<span " +
            "class=\"its-tag\" data-tag-ref=\"item_2061_TAG_10\" data-tag-boundary=\"end\"></span> of 11 minutes?</p>");
        return content;
    }

    /**
     * The minimum list of attributes when creating a new item.
     *
     * @param itemFormat       The Item Format attribute value.
     * @param itemPageLayout   The Page Layout attribute value.
     * @param itemResponseType The Response Type attribute value.
     * @return The minimum list of attributes.
     */
    public ItemRelease.Item.Attriblist newItemAttributeList(String itemFormat,
                                                            String itemPageLayout,
                                                            String itemResponseType) {
        final ItemRelease.Item.Attriblist attriblist = FACTORY.createItemreleaseItemAttriblist();
        attriblist.getAttrib().add(newAttribute("itm_item_id", "Item: ITS ID", itemFormat));
        attriblist.getAttrib().add(newAttribute("itm_att_Item Format", "Item: Item Format", itemFormat.toUpperCase()));
        attriblist.getAttrib().add(newAttribute("itm_att_Answer Key", "Item: Answer Key", itemFormat.toUpperCase()));
        attriblist.getAttrib().add(newAttribute("itm_att_Page Layout", "Item: Page Layout", itemPageLayout));
        attriblist.getAttrib().add(newAttribute("itm_att_Response Type", "Item: Response Type", itemResponseType));
        return attriblist;
    }

    /**
     * Creates a new {@link ItemRelease.Item.Attriblist.Attrib} instance.
     *
     * @param attid The attribute id.
     * @param name  The attribute name.
     * @param val   The attribute value.
     * @return An {@link ItemRelease.Item.Attriblist.Attrib}.
     */
    public ItemRelease.Item.Attriblist.Attrib newAttribute(String attid, String name, String val) {
        final ItemRelease.Item.Attriblist.Attrib attribute = FACTORY.createItemreleaseItemAttriblistAttrib();
        attribute.setAttid(attid);
        attribute.setName(name);
        attribute.setVal(val);
        attribute.setDesc("");
        return attribute;
    }
}
