/*
 *  Copyright 2017 Regents of the University of California.
 *
 *  Licensed under the Educational Community License, Version 2.0 (the "license");
 *  you may not use this file except in compliance with the License. You may
 *  obtain a copy of the license at
 *
 *  https://opensource.org/licenses/ECL-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 */
package org.opentestsystem.saaif.item;

import static org.apache.commons.lang3.StringUtils.EMPTY;
import static org.opentestsystem.saaif.item.ItemConstants.ItemAttribute.ItemAnswerKey;
import static org.opentestsystem.saaif.item.ItemConstants.ItemAttribute.ItemFormat;
import static org.opentestsystem.saaif.item.ItemConstants.ItemAttribute.ItemId;
import static org.opentestsystem.saaif.item.ItemConstants.ItemAttribute.ItemPageLayout;
import static org.opentestsystem.saaif.item.ItemConstants.ItemAttribute.ItemResponseType;
import static org.opentestsystem.saaif.item.ItemConstants.ItemFormat.FORMAT_SHORT_ANSWER;
import static org.opentestsystem.saaif.item.ItemConstants.ItemPageLayout.PAGE_LAYOUT_SHORT_ANSWER;
import static org.opentestsystem.saaif.item.ItemConstants.ItemResponseType.RESPONSE_TYPE_HTML_EDITOR;
import static org.opentestsystem.saaif.item.ItemConstants.ItemVersion.ITEM_RELEASE_VERSION;
import static org.opentestsystem.saaif.item.ItemConstants.ItemVersion.ITEM_VERSION;

/**
 * Creates different entities, setting specific properties depending on what is required and depending on different
 * scenarios like if the item is "new" meaning set the minimum valid data on the object.
 */
public class ItemFactory {

    private static final ObjectFactory FACTORY = new ObjectFactory();

    /**
     * The minimum valid {@link org.opentestsystem.saaif.item.ItemRelease} instance using
     * ENU as the only language to create a content section for.
     *
     * @param itemId     The item id to set.
     * @param itemFormat The item format to create.
     * @return An {@link org.opentestsystem.saaif.item.ItemRelease} instance.
     */
    public ItemRelease newDefaultItemRelease(String itemId, String itemFormat) {
        final ItemRelease itemRelease = FACTORY.createItemrelease();
        itemRelease.setVersion(ITEM_RELEASE_VERSION);
        itemRelease.setItem(newItem(itemId, itemFormat));
        return newItemRelease(itemId, itemFormat, ItemConstants.ItemLanguage.LANG_EN);
    }

    /**
     * The minimum valid {@link org.opentestsystem.saaif.item.ItemRelease} instance.
     *
     * @param itemId     The item id to set.
     * @param itemFormat The item format to create.
     * @param languages  The content sections to create, one per language.
     * @return An {@link org.opentestsystem.saaif.item.ItemRelease} instance.
     */
    public ItemRelease newItemRelease(String itemId, String itemFormat, String... languages) {
        final ItemRelease itemRelease = FACTORY.createItemrelease();
        itemRelease.setVersion(ITEM_RELEASE_VERSION);
        itemRelease.setItem(newItem(itemId, itemFormat, languages));
        return itemRelease;
    }

    /**
     * The minimum valid {@link org.opentestsystem.saaif.item.ItemRelease.Item} instance.
     *
     * @param itemId     The item id to set.
     * @param itemFormat The item format to create.
     * @param languages  The content sections to create, one per language.
     * @return An {@link org.opentestsystem.saaif.item.ItemRelease.Item} instance.
     */
    public ItemRelease.Item newItem(String itemId, String itemFormat, String... languages) {
        final ItemRelease.Item item;
        switch (itemFormat) {
            case FORMAT_SHORT_ANSWER:
                item = newShortAnswerItem(itemId, languages);
                break;
            default:
                item = null;
                break;
        }
        return item;
    }

    /**
     * The minimum valid short answer {@link org.opentestsystem.saaif.item.ItemRelease.Item} instance.  A minimum short
     * answer requires at least one {@link org.opentestsystem.saaif.item.ItemRelease.Item.Content} instance so there
     * should be at least one language passed in.  For each language given, there will be that number of minimum {@link
     * org.opentestsystem.saaif.item.ItemRelease.Item.Content} instances associated with the item.
     *
     * @param itemId    The item ID to set.
     * @param languages The languages to create {@link org.opentestsystem.saaif.item.ItemRelease.Item.Content}
     *                  instances.
     * @return A {@link org.opentestsystem.saaif.item.ItemRelease.Item} instance.
     */
    public ItemRelease.Item newShortAnswerItem(String itemId, String... languages) {
        final ItemRelease.Item.Attriblist attributeList = newItemAttributeList(FORMAT_SHORT_ANSWER,
            PAGE_LAYOUT_SHORT_ANSWER, RESPONSE_TYPE_HTML_EDITOR);

        final ItemRelease.Item item = FACTORY.createItemreleaseItem();
        item.setId(itemId);
        item.setFormat(FORMAT_SHORT_ANSWER);
        item.setVersion(ITEM_VERSION);
        item.setAttriblist(attributeList);

        if (languages != null) {
            for (String lang : languages) {
                item.getContent().add(newContent(lang));
            }
        }

        return item;
    }

    /**
     * The minimum valid {@link org.opentestsystem.saaif.item.ItemRelease.Item.Content} instance.
     *
     * @param lang The content language to set.
     * @return A {@link org.opentestsystem.saaif.item.ItemRelease.Item.Content} instance.
     */
    public ItemRelease.Item.Content newContent(String lang) {
        final ItemRelease.Item.Content content = FACTORY.createItemreleaseItemContent();
        content.setVersion(ITEM_RELEASE_VERSION);
        content.setLanguage(lang);
        content.setStem(EMPTY);
        return content;
    }

    /**
     * The minimum list of attributes when creating a new item.
     *
     * @param itemFormat       The Item Format attribute value.
     * @param itemPageLayout   The Page Layout attribute value.
     * @param itemResponseType The Response Type attribute value.
     * @return The minimum list of attributes.
     */
    public ItemRelease.Item.Attriblist newItemAttributeList(String itemFormat,
                                                            String itemPageLayout,
                                                            String itemResponseType) {
        final ItemRelease.Item.Attriblist attriblist = FACTORY.createItemreleaseItemAttriblist();
        attriblist.getAttrib().add(newAttribute(ItemId, itemFormat));
        attriblist.getAttrib().add(newAttribute(ItemFormat, itemFormat.toUpperCase()));
        attriblist.getAttrib().add(newAttribute(ItemAnswerKey, itemFormat.toUpperCase()));
        attriblist.getAttrib().add(newAttribute(ItemPageLayout, itemPageLayout));
        attriblist.getAttrib().add(newAttribute(ItemResponseType, itemResponseType));
        return attriblist;
    }

    /**
     * Creates attribute new {@link ItemRelease.Item.Attriblist.Attrib} instance.
     *
     * @param attribute
     * @param val       The attribute value.
     * @return An {@link ItemRelease.Item.Attriblist.Attrib} instance.
     */
    public ItemRelease.Item.Attriblist.Attrib newAttribute(ItemConstants.ItemAttribute attribute, String val) {
        return newAttribute(attribute.getAttId(), attribute.getName(), val);
    }

    /**
     * Creates a new {@link ItemRelease.Item.Attriblist.Attrib} instance.
     *
     * @param attid The attribute id.
     * @param name  The attribute name.
     * @param val   The attribute value.
     * @return An {@link ItemRelease.Item.Attriblist.Attrib} instance.
     */
    public ItemRelease.Item.Attriblist.Attrib newAttribute(String attid, String name, String val) {
        final ItemRelease.Item.Attriblist.Attrib attribute = FACTORY.createItemreleaseItemAttriblistAttrib();
        attribute.setAttid(attid);
        attribute.setName(name);
        attribute.setVal(val);
        attribute.setDesc(EMPTY);
        return attribute;
    }
}
